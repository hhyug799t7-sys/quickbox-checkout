  <!-- Paddle JS v2 -->
  <script src="https://cdn.paddle.com/paddle/v2/paddle.js"></script>
  <script>
    // Usa aqui o token CERTO:
    //   - se estiveres a testar com pre√ßos sandbox, usa o CLIENT TOKEN SANDBOX
    //   - se estiveres em produ√ß√£o, usa o CLIENT TOKEN LIVE
    const PADDLE_CLIENT_TOKEN = "test_eae115a2a91c654f9abddd38106";

    function getParam(name) {
      const url = new URL(window.location.href);
      return url.searchParams.get(name);
    }

    function setStatus(texto) {
      const el = document.getElementById("status-text");
      if (el) el.textContent = texto;
    }

    function showError(texto) {
      const el = document.getElementById("error");
      if (el) {
        el.style.display = "block";
        el.textContent = texto;
      }
    }

    window.addEventListener("DOMContentLoaded", () => {
      try {
        if (!window.Paddle) {
          console.error("[QuickBox checkout] Paddle n√£o carregou (window.Paddle undefined)");
          setStatus("N√£o foi poss√≠vel carregar o checkout da Paddle.");
          showError("Parece que o script da Paddle n√£o carregou. Verifica a liga√ß√£o ou tenta novamente.");
          return;
        }

        // üëâ N√ÉO mexemos mais em sandbox/live aqui.
        // O pr√≥prio token (sandbox ou live) j√° define o ambiente certo.
        Paddle.Initialize({
          token: PADDLE_CLIENT_TOKEN,
          checkout: {
            settings: {
              displayMode: "overlay",
              variant: "one-page",
              locale: "pt",
              theme: "dark"
            }
          }
        });

        const plan = getParam("plan") || "monthly";
        const priceId = getParam("priceId");
        const profileId = getParam("profile_id");
        const email = getParam("email");

        const planText = document.getElementById("plan-text");
        if (planText) {
          const planLabel =
            plan === "yearly"
              ? "Plano anual"
              : plan === "lifetime"
              ? "Plano lifetime"
              : "Plano mensal";
          planText.textContent = planLabel;
        }

        if (!priceId) {
          console.error("[QuickBox checkout] priceId em falta nos par√¢metros.");
          setStatus("N√£o foi poss√≠vel preparar o checkout.");
          showError("PriceId em falta. Volta √† extens√£o QuickBox e tenta novamente.");
          return;
        }

        const options = {
          settings: {
            displayMode: "overlay",
            variant: "one-page",
            locale: "pt",
            theme: "dark"
          },
          items: [{ priceId, quantity: 1 }],
          customData: {
            profile_id: profileId || null,
            plan
          }
        };

        if (email) {
          options.customer = { email };
        }

        setStatus("A abrir checkout seguro do QuickBox via Paddle‚Ä¶");

        console.log("[QuickBox checkout] Abrir checkout Paddle:", {
          plan,
          priceId,
          profileId,
          email
        });

        try {
          Paddle.Checkout.open(options);
        } catch (err) {
          console.error("[QuickBox checkout] Erro ao abrir checkout:", err);
          setStatus("N√£o foi poss√≠vel abrir o checkout.");
          showError("Erro da Paddle ao abrir o checkout. Verifica token, ambiente e priceId.");
        }
      } catch (e) {
        console.error("[QuickBox checkout] Erro inesperado:", e);
        setStatus("N√£o foi poss√≠vel preparar o checkout.");
        showError("Erro inesperado ao preparar o checkout. V√™ a consola para detalhes.");
      }
    });
  </script>
